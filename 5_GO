### Prepare input for GO-analysis
# 1st DMCs and DMRs are divided into hyper and hypo methylated bed files, so we have: DMCs_hyper_5X.BED DMCs_hypo_5X.BED DMRs_hyper_5X.BED DMRs_hypo_5X.BED 
#not 
#We make a file of all promoters and genes. 
cat GCF_000233375.1_ICSASG_v2_genomic_250promoter.bed GCF_000233375.1_ICSASG_v2_genomic_1Kpromoter.bed GCF_000233375.1_ICSASG_v2_genomic_6Kpromoter.bed GCF_000233375.1_ICSASG_v2_genomic_gene.bed |bedtools sort -i stdin > GCF_000233375.1_ICSASG_v2_genomic_gene_and_promoter.bed
#make background file of all genes and promoters covered at 5X threshold 
bedtools intersect -b 5X_cov_CpGs.bed -a GCF_000233375.1_ICSASG_v2_genomic_gene_and_promoter.bed | cut -f 10 |tr ";" "\n" | grep -E '^(Dbxref=GeneID):' | sed -e "s/^Dbxref=GeneID://" | uniq > 5X_cov_X_PG.txt
#make DMC file with all genes with DMCs in promoter or genebody 
bedtools intersect -b 5X_DMCs.bed -a GCF_000233375.1_ICSASG_v2_genomic_gene_and_promoter.bed | cut -f 10 |tr ";" "\n" | grep -E '^(Dbxref=GeneID):' | sed -e "s/^Dbxref=GeneID://" | uniq > 5X_DMC_X_PG.txt 

#We make a file of all promoters. 
cat GCF_000233375.1_ICSASG_v2_genomic_250promoter.bed GCF_000233375.1_ICSASG_v2_genomic_1Kpromoter.bed GCF_000233375.1_ICSASG_v2_genomic_6Kpromoter.bed | bedtools sort -i stdin > GCF_000233375.1_ICSASG_v2_genomic_promoter.bed
#make background file of all promoters covered at 5X threshold 
bedtools intersect -b 5X_cov_CpGs.bed -a GCF_000233375.1_ICSASG_v2_genomic_promoter.bed | cut -f 10 |tr ";" "\n" | grep -E '^(Dbxref=GeneID):' | sed -e "s/^Dbxref=GeneID://" | uniq > 5X_cov_X_P.txt
#make DMC file with all genes with DMCs in promoter
bedtools intersect -b 5X_DMCs.bed -a GCF_000233375.1_ICSASG_v2_genomic_promoter.bed | cut -f 10 |tr ";" "\n" | grep -E '^(Dbxref=GeneID):' | sed -e "s/^Dbxref=GeneID://" | uniq > 5X_DMC_X_P.txt 
#make DMR file with all genes with DMRs in promoter
bedtools intersect -b 5X_DMRs.bed -a GCF_000233375.1_ICSASG_v2_genomic_promoter.bed | cut -f 10 |tr ";" "\n" | grep -E '^(Dbxref=GeneID):' | sed -e "s/^Dbxref=GeneID://" | uniq > 5X_DMR_X_P.txt

### We make a background file with all covered sites (myDiff) and each feature 250promoter, 1Kpromoter, 6Kpromoter
for i in 250promoter 1Kpromoter 6Kpromoter
do bedtools intersect -a GCF_000233375.1_ICSASG_v2_genomic_$i.gff -b myDiff_5X.BED | cut -f 10 |tr ";" "\n" | grep -E '^(Dbxref=GeneID):' | sed -e "s/^Dbxref=GeneID://" > $i.bg.txt
done

### We find overlaps between 250P and write the genes with overlaps into files 
for i in DMCs_hyper_5X DMCs_hypo_5X DMRs_hyper_5X DMRs_hypo_5X
do bedtools intersect -a GCF_000233375.1_ICSASG_v2_genomic_250promoter.gff -b $i.BED | cut -f 9 |tr ";" "\n" | grep -E '^(Dbxref=GeneID):' | sed -e "s/^Dbxref=GeneID://" > 250Px$i.txt
done

### We find overlaps between 1KP and write the genes with overlaps into files 
for i in DMCs_hyper_5X DMCs_hypo_5X DMRs_hyper_5X DMRs_hypo_5X
do bedtools intersect -a GCF_000233375.1_ICSASG_v2_genomic_1Kpromoter.gff -b $i.BED | cut -f 9 |tr ";" "\n" | grep -E '^(Dbxref=GeneID):' | sed -e "s/^Dbxref=GeneID://" > 1KPx$i.txt
done

### We find overlaps between 6KP and write the genes with overlaps into files 
for i in DMCs_hyper_5X DMCs_hypo_5X DMRs_hyper_5X DMRs_hypo_5X
do bedtools intersect -a GCF_000233375.1_ICSASG_v2_genomic_6Kpromoter.gff -b $i.BED | cut -f 9 |tr ";" "\n" | grep -E '^(Dbxref=GeneID):' | sed -e "s/^Dbxref=GeneID://" > 6KPx$i.txt
done

### make gathered file of promoters
for i in DMRs_hyper_5X.txt DMRs_hypo_5X.txt DMCs_hyper_5X.txt DMCs_hypo_5X.txt
do cat *$i > promoter_$i
done 

### We find overlaps between genes and features and write the genes with overlaps into files 
for i in DMCs_hyper_5X DMCs_hypo_5X DMRs_hyper_5X DMRs_hypo_5X
do bedtools intersect -a GCF_000233375.1_ICSASG_v2_genomic_gene.gff -b $i.BED | cut -f 9 |tr ";" "\n" | grep -E '^(Dbxref=GeneID):' | sed -e "s/^Dbxref=GeneID://" > Genesx$i.txt
done

### make gathered file of promoters and genes 
for i in DMRs_hyper_5X.txt DMRs_hypo_5X.txt DMCs_hyper_5X.txt DMCs_hypo_5X.txt
do cat promoter_$i Genesx$i > PGx$i
done 

### and bg file 
cat Genes.bg.txt all_promoter.bg.txt >PG.bg.txt


